# üîí Guide : Configuration reCAPTCHA et RGPD

## **üìã Vue d'ensemble**

Ce guide explique comment configurer **reCAPTCHA** pour la s√©curit√© des formulaires et le syst√®me de **gestion des cookies RGPD**.

---

## **üîê PARTIE 1 : Configuration reCAPTCHA**

### **1Ô∏è‚É£ Obtenir les cl√©s reCAPTCHA**

1. **Allez sur** : https://www.google.com/recaptcha/admin/create

2. **Remplissez le formulaire** :
   - **Label** : `MyBudget+ Production`
   - **Type reCAPTCHA** : S√©lectionnez **reCAPTCHA v2** ‚Üí **"Je ne suis pas un robot"**
   - **Domaines** : 
     - `localhost` (d√©veloppement)
     - `yourdomain.com` (production)
   - Acceptez les conditions

3. **Copiez vos cl√©s** :
   - **Site Key** (cl√© publique) : √Ä utiliser dans le frontend
   - **Secret Key** (cl√© secr√®te) : √Ä utiliser dans le backend

---

### **2Ô∏è‚É£ Configuration Frontend**

1. **Cr√©ez le fichier** `MyBudget+/apps/web/.env` (si pas d√©j√† cr√©√©) :

```env
# URL de l'API backend
VITE_API_URL=http://localhost:3001/api

# reCAPTCHA v2 Site Key (Cl√© publique)
VITE_RECAPTCHA_SITE_KEY=VOTRE_SITE_KEY_ICI
```

2. **Remplacez** `VOTRE_SITE_KEY_ICI` par la **Site Key** copi√©e √† l'√©tape 1

3. **Red√©marrez le frontend** :
```bash
cd MyBudget+/apps/web
npm run dev
```

---

### **3Ô∏è‚É£ Configuration Backend**

1. **Ouvrez** `MyBudget+/backend/.env`

2. **Ajoutez cette ligne** :
```env
# reCAPTCHA Secret Key (Cl√© secr√®te)
RECAPTCHA_SECRET_KEY=VOTRE_SECRET_KEY_ICI
```

3. **Remplacez** `VOTRE_SECRET_KEY_ICI` par la **Secret Key** copi√©e √† l'√©tape 1

4. **Red√©marrez le backend** :
```bash
cd MyBudget+/backend
npm run dev
```

---

### **4Ô∏è‚É£ O√π reCAPTCHA est int√©gr√©**

Le reCAPTCHA est maintenant actif sur :

- ‚úÖ `/login` - Connexion utilisateur
- ‚úÖ `/signup` - Inscription utilisateur
- ‚úÖ `/admin/login` - Connexion admin
- ‚úÖ `/admin/signup` - Inscription admin (√† int√©grer si n√©cessaire)

---

### **üß™ Test en d√©veloppement**

**Cl√© de TEST fournie par Google** (utilis√©e par d√©faut) :

```
Site Key: 6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI
```

Cette cl√© **ACCEPTE TOUJOURS** la validation en d√©veloppement local. Elle ne fonctionne **PAS en production** !

---

## **üç™ PARTIE 2 : Gestion des Cookies RGPD**

### **1Ô∏è‚É£ Composants cr√©√©s**

#### **`CookieConsent.jsx`**
- Banni√®re de consentement RGPD conforme
- Gestion granulaire des pr√©f√©rences :
  - **N√©cessaires** (obligatoires) : Authentification, s√©curit√©
  - **Analytiques** (optionnels) : Google Analytics, statistiques
  - **Marketing** (optionnels) : Publicit√©s personnalis√©es
- Sauvegarde dans `localStorage`
- Support mode sombre

#### **`PrivacyPolicyPage.jsx`**
- Page de politique de confidentialit√© compl√®te
- Explique la collecte et l'utilisation des donn√©es
- Liste les droits RGPD de l'utilisateur
- Accessible via `/privacy-policy`

---

### **2Ô∏è‚É£ Fonctionnalit√©s RGPD**

#### **Banni√®re de cookies**
La banni√®re s'affiche **automatiquement** √† la premi√®re visite. Options :

1. **"Accepter tout"** : Active tous les cookies (n√©cessaires + analytiques + marketing)
2. **"Refuser tout"** : N'active que les cookies n√©cessaires
3. **"Personnaliser"** : Choix granulaire des cat√©gories

#### **Pr√©f√©rences sauvegard√©es**
- Stock√©es dans `localStorage` sous la cl√© `cookieConsent`
- Date d'acceptation enregistr√©e
- Pr√©f√©rences appliqu√©es imm√©diatement

#### **√âv√©nements Google Tag Manager**
Lorsque l'utilisateur fait un choix, des √©v√©nements sont envoy√©s :
- `cookie_consent_all` : Tous accept√©s
- `cookie_consent_reject` : Tous refus√©s
- `cookie_consent_custom` : Choix personnalis√©

---

### **3Ô∏è‚É£ Int√©gration Google Analytics (optionnel)**

Si vous voulez activer **Google Analytics** en respectant le RGPD :

1. **Cr√©ez** `MyBudget+/apps/web/public/analytics.js` :

```javascript
// Google Analytics 4 - GA4
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

// Par d√©faut, bloquer les analytics jusqu'au consentement
gtag('consent', 'default', {
  'analytics_storage': 'denied',
  'ad_storage': 'denied'
});

// Fonction pour mettre √† jour le consentement
window.updateGAConsent = function(analytics, marketing) {
  gtag('consent', 'update', {
    'analytics_storage': analytics ? 'granted' : 'denied',
    'ad_storage': marketing ? 'granted' : 'denied'
  });
};

// Initialiser GA4
gtag('js', new Date());
gtag('config', 'G-XXXXXXXXXX'); // Remplacez par votre Measurement ID
```

2. **Modifiez** `MyBudget+/apps/web/index.html` :

```html
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script src="/analytics.js"></script>
```

3. **Modifiez** `CookieConsent.jsx` pour mettre √† jour GA :

```javascript
// Dans handleAcceptAll, handleRejectAll, handleSavePreferences
if (window.updateGAConsent) {
  window.updateGAConsent(preferences.analytics, preferences.marketing);
}
```

---

### **4Ô∏è‚É£ Pages et liens**

#### **Politique de confidentialit√©**
- **URL** : `/privacy-policy`
- **Accessible depuis** :
  - Banni√®re de cookies : "En savoir plus"
  - Footer du site
  - Formulaires d'inscription

#### **Liens √† ajouter dans le Footer**
Cr√©ez un composant Footer avec :
```jsx
<Link to="/privacy-policy">Politique de confidentialit√©</Link>
<Link to="/terms">Conditions d'utilisation</Link>
<button onClick={openCookieSettings}>G√©rer les cookies</button>
```

---

## **‚úÖ Checklist de conformit√© RGPD**

- [x] Banni√®re de consentement affich√©e avant tout cookie non n√©cessaire
- [x] Choix granulaire (accepter/refuser par cat√©gorie)
- [x] Politique de confidentialit√© accessible et compl√®te
- [x] Cookies n√©cessaires clairement identifi√©s
- [x] Consentement sauvegard√© et horodat√©
- [x] Possibilit√© de retirer le consentement (via "G√©rer les cookies")
- [x] Donn√©es chiffr√©es (HTTPS, bcrypt pour mots de passe)
- [ ] **√Ä compl√©ter** : Formulaire de contact DPO (D√©l√©gu√© √† la Protection des Donn√©es)
- [ ] **√Ä compl√©ter** : Processus d'exercice des droits (acc√®s, rectification, suppression)

---

## **üöÄ D√©ploiement en production**

### **1. reCAPTCHA**
- ‚úÖ Cr√©ez une **nouvelle cl√© reCAPTCHA** pour le domaine de production
- ‚úÖ Ajoutez votre domaine dans la configuration reCAPTCHA
- ‚úÖ Mettez √† jour les variables d'environnement Vercel :
  - `VITE_RECAPTCHA_SITE_KEY` (frontend)
  - `RECAPTCHA_SECRET_KEY` (backend)

### **2. RGPD**
- ‚úÖ V√©rifiez que la politique de confidentialit√© est √† jour
- ‚úÖ Ajoutez l'adresse de contact r√©elle (email, adresse postale)
- ‚úÖ Testez la banni√®re de cookies sur tous les navigateurs
- ‚úÖ Assurez-vous que Google Analytics (si utilis√©) respecte le consentement

### **3. HTTPS**
- ‚úÖ Activez HTTPS sur Vercel (automatique)
- ‚úÖ Forcez la redirection HTTP ‚Üí HTTPS

---

## **üìö Ressources suppl√©mentaires**

- **reCAPTCHA** : https://www.google.com/recaptcha/
- **RGPD (CNIL)** : https://www.cnil.fr/
- **Google Analytics & RGPD** : https://support.google.com/analytics/answer/9019185
- **Cookies & RGPD** : https://www.cnil.fr/fr/cookies-et-autres-traceurs

---

## **üÜò Support**

Si vous avez des questions :
- **Email** : privacy@mybudget.com
- **Email technique** : support@mybudget.com

---

**‚úÖ Votre application est maintenant conforme RGPD et s√©curis√©e avec reCAPTCHA !** üéâ

