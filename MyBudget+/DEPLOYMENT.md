# Guide de D√©ploiement - MyBudget+

Ce guide vous explique comment h√©berger votre application MyBudget+ avec :
- **Frontend** (React/Vite) sur **Vercel** (gratuit)
- **Backend** (Node.js/Express) sur **Render** ou **Railway** (gratuit)
- **Base de donn√©es** MongoDB sur **MongoDB Atlas** (gratuit)

## üìã Pr√©requis

- Un compte [Vercel](https://vercel.com) (gratuit)
- Un compte [Render](https://render.com) ou [Railway](https://railway.app) (gratuit)
- Un compte [MongoDB Atlas](https://www.mongodb.com/cloud/atlas) (gratuit)
- Un compte Gmail pour l'envoi d'emails (ou service SMTP)
- Un compte [reCAPTCHA](https://www.google.com/recaptcha) (gratuit)

---

## üóÑÔ∏è √âTAPE 1 : Configurer MongoDB Atlas

### 1.1 Cr√©er un cluster gratuit
1. Allez sur [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Cr√©ez un compte gratuit
3. Cr√©ez un nouveau cluster **M0 Free**
4. S√©lectionnez une r√©gion proche de vous

### 1.2 Cr√©er un utilisateur de base de donn√©es
1. Cliquez sur **Database Access** dans le menu
2. Cliquez sur **Add New Database User**
3. Choisissez **Password** comme m√©thode d'authentification
4. Entrez un nom d'utilisateur et un mot de passe
5. Donnez le r√¥le **Atlas admin**
6. Cliquez sur **Add User**

### 1.3 Configurer l'acc√®s r√©seau
1. Cliquez sur **Network Access** dans le menu
2. Cliquez sur **Add IP Address**
3. Cliquez sur **Allow Access from Anywhere** (0.0.0.0/0)
4. Cliquez sur **Confirm**

### 1.4 Obtenir la cha√Æne de connexion
1. Cliquez sur **Database** dans le menu
2. Cliquez sur **Connect** sur votre cluster
3. Choisissez **Connect your application**
4. Copiez la cha√Æne de connexion
5. Remplacez `<password>` par votre mot de passe
6. Remplacez `<database-name>` par `mybudget`

**Exemple :**
```
mongodb+srv://username:password@cluster0.xxxxx.mongodb.net/mybudget?retryWrites=true&w=majority
```

---

## üîß √âTAPE 2 : Configurer le Backend sur Render

### 2.1 Pr√©parer le backend pour le d√©ploiement

Cr√©ez un fichier `render.yaml` dans le dossier `backend/` :

```yaml
services:
  - type: web
    name: mybudget-backend
    env: node
    plan: free
    buildCommand: npm install
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3001
      - key: MONGO_URI
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: SESSION_SECRET
        sync: false
      - key: EMAIL_USER
        sync: false
      - key: EMAIL_PASS
        sync: false
      - key: RECAPTCHA_SECRET_KEY
        sync: false
      - key: FRONTEND_URL
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: PAYPAL_CLIENT_ID
        sync: false
      - key: PAYPAL_CLIENT_SECRET
        sync: false
      - key: PAYPAL_MODE
        value: sandbox
```

### 2.2 D√©ployer le backend sur Render

1. Allez sur [Render](https://render.com)
2. Cr√©ez un compte gratuit
3. Cliquez sur **New +** puis **Web Service**
4. Connectez votre repository GitHub
5. Configurez le service :
   - **Name** : `mybudget-backend`
   - **Region** : Europe (Frankfurt) ou USA
   - **Branch** : `main` ou `master`
   - **Root Directory** : `backend`
   - **Runtime** : Node
   - **Build Command** : `npm install`
   - **Start Command** : `npm start`
6. Cliquez sur **Advanced** et ajoutez les variables d'environnement :

```env
NODE_ENV=production
PORT=3001
MONGO_URI=mongodb+srv://username:password@cluster0.xxxxx.mongodb.net/mybudget?retryWrites=true&w=majority
JWT_SECRET=votre_secret_jwt_tres_long_et_aleatoire
SESSION_SECRET=votre_secret_session_tres_long_et_aleatoire
EMAIL_USER=votre_email@gmail.com
EMAIL_PASS=votre_mot_de_passe_application
RECAPTCHA_SECRET_KEY=votre_cle_recaptcha
FRONTEND_URL=https://votre-app.vercel.app
GOOGLE_CLIENT_ID=votre_google_client_id
GOOGLE_CLIENT_SECRET=votre_google_client_secret
PAYPAL_CLIENT_ID=votre_paypal_client_id
PAYPAL_CLIENT_SECRET=votre_paypal_client_secret
PAYPAL_MODE=sandbox
```

7. Cliquez sur **Create Web Service**
8. Render va d√©ployer votre backend
9. Notez l'URL du backend : `https://mybudget-backend.onrender.com`

**‚ö†Ô∏è Note :** Avec le plan gratuit, le backend se met en veille apr√®s 15 minutes d'inactivit√©. Le premier chargement apr√®s une veille peut prendre 30-60 secondes.

---

## üåê √âTAPE 3 : Configurer le Frontend sur Vercel

### 3.1 Cr√©er un fichier `.env.production`

Dans le dossier `apps/web/`, cr√©ez un fichier `.env.production` :

```env
VITE_API_URL=https://mybudget-backend.onrender.com/api
```

### 3.2 D√©ployer le frontend sur Vercel

1. Allez sur [Vercel](https://vercel.com)
2. Cr√©ez un compte gratuit
3. Cliquez sur **Add New...** puis **Project**
4. Importez votre repository GitHub
5. Configurez le projet :
   - **Framework Preset** : Vite
   - **Root Directory** : `apps/web`
   - **Build Command** : `npm run build`
   - **Output Directory** : `dist`
   - **Install Command** : `npm install`
6. Ajoutez la variable d'environnement :
   - **Name** : `VITE_API_URL`
   - **Value** : `https://mybudget-backend.onrender.com/api`
7. Cliquez sur **Deploy**
8. Vercel va d√©ployer votre frontend
9. Notez l'URL du frontend : `https://votre-app.vercel.app`

### 3.3 Mettre √† jour la variable FRONTEND_URL dans Render

1. Retournez sur Render
2. Allez dans les **Environment** de votre backend
3. Mettez √† jour `FRONTEND_URL` avec l'URL Vercel
4. Sauvegardez et red√©marrez le service

---

## üìß √âTAPE 4 : Configurer les Emails (Gmail)

### 4.1 Activer l'authentification √† deux facteurs
1. Allez sur [Google Account](https://myaccount.google.com)
2. Cliquez sur **Security**
3. Activez **2-Step Verification**

### 4.2 G√©n√©rer un mot de passe d'application
1. Dans **Security**, cherchez **App passwords**
2. Cliquez sur **App passwords**
3. S√©lectionnez **Mail** et **Other (Custom name)**
4. Entrez "MyBudget" comme nom
5. Cliquez sur **Generate**
6. Copiez le mot de passe (16 caract√®res sans espaces)

Dans les variables d'environnement de Render :
- `EMAIL_USER` : Votre adresse Gmail compl√®te
- `EMAIL_PASS` : Le mot de passe d'application g√©n√©r√©

---

## üîê √âTAPE 5 : Configurer reCAPTCHA

1. Allez sur [reCAPTCHA](https://www.google.com/recaptcha/admin)
2. Cliquez sur **+** pour cr√©er un nouveau site
3. Remplissez :
   - **Label** : MyBudget
   - **reCAPTCHA type** : reCAPTCHA v2
   - **Domains** : `votre-app.vercel.app` (et `localhost` pour le d√©veloppement)
4. Acceptez les conditions
5. Cliquez sur **Submit**
6. Copiez **Site Key** et **Secret Key**

Dans les variables d'environnement de Render :
- `RECAPTCHA_SECRET_KEY` : La Secret Key copi√©e

Dans votre code frontend, vous devrez utiliser le Site Key (√† configurer s√©par√©ment dans le frontend).

---

## üîë √âTAPE 6 : G√©n√©rer les Secrets JWT

Ouvrez un terminal et ex√©cutez :

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

Ex√©cutez cette commande **deux fois** pour obtenir :
- `JWT_SECRET`
- `SESSION_SECRET`

Ajoutez-les dans les variables d'environnement de Render.

---

## ‚úÖ √âTAPE 7 : V√©rifier le D√©ploiement

1. Visitez votre site Vercel : `https://votre-app.vercel.app`
2. Cr√©ez un compte
3. V√©rifiez que vous recevez des emails de confirmation
4. Connectez-vous et testez l'application

---

## üêõ D√©pannage

### Le backend ne d√©marre pas
- V√©rifiez que toutes les variables d'environnement sont correctement d√©finies
- Consultez les logs dans Render
- V√©rifiez que MongoDB Atlas accepte les connexions depuis 0.0.0.0/0

### Erreur CORS
- Assurez-vous que `FRONTEND_URL` dans Render correspond exactement √† l'URL Vercel
- V√©rifiez que l'URL se termine par un `/` si n√©cessaire

### Les emails ne s'envoient pas
- V√©rifiez que vous utilisez un **App Password** et non votre mot de passe Gmail
- V√©rifiez que l'authentification √† deux facteurs est activ√©e

### Le backend est lent au premier chargement
- C'est normal avec le plan gratuit de Render
- Les requ√™tes suivantes seront rapides

---

## üìä Plans de Tarification

### Gratuit (D√©veloppement)
- **Vercel** : Illimit√©
- **Render** : Backend gratuit (15 min de timeout, veille apr√®s inactivit√©)
- **MongoDB Atlas** : 512 MB de stockage

### Payant (Production)
- **Vercel Pro** : $20/mois
- **Render Standard** : $7/mois
- **MongoDB Atlas M10** : ~$50/mois

---

## üîÑ Mises √† Jour

Pour d√©ployer une mise √† jour :
1. Committez vos changements sur GitHub
2. Push sur la branche `main` ou `master`
3. Vercel et Render d√©ploieront automatiquement

---

## üìû Support

En cas de probl√®me :
1. Consultez les logs dans Vercel et Render
2. V√©rifiez que toutes les variables d'environnement sont correctes
3. Testez les API directement avec Postman

**Bon d√©ploiement ! üöÄ**
