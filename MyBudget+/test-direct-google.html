<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Direct Google OAuth</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; }
        .box { background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 20px 0; }
        button { padding: 15px 30px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; }
        .primary { background: #4285F4; color: white; }
        .primary:hover { background: #357ae8; }
        .info { background: #e8f4f8; padding: 15px; border-left: 4px solid #4285F4; margin: 20px 0; }
        code { background: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üß™ Test Direct Google OAuth</h1>
    
    <div class="info">
        <strong>üìã Configuration actuelle :</strong><br><br>
        <strong>Backend :</strong> <code>http://localhost:3001</code><br>
        <strong>Endpoint Google :</strong> <code>http://localhost:3001/api/auth/google</code><br>
        <strong>Callback attendu :</strong> <code>http://localhost:3001/api/auth/google/callback</code>
    </div>

    <div class="box">
        <h2>Test 1 : Backend disponible</h2>
        <button class="primary" onclick="testBackend()">Tester le backend</button>
        <div id="result1"></div>
    </div>

    <div class="box">
        <h2>Test 2 : Endpoint Google (avec redirection)</h2>
        <button class="primary" onclick="testGoogleRedirect()">Tester Google OAuth</button>
        <p style="color: #666; font-size: 14px;">
            ‚ö†Ô∏è Cela va vous rediriger vers Google.<br>
            Si vous avez une erreur 400, c'est que Google Console est mal configur√©.
        </p>
        <div id="result2"></div>
    </div>

    <div class="box">
        <h2>üìã √Ä v√©rifier dans Google Console</h2>
        <p>Allez sur : <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Console Credentials</a></p>
        
        <h3>‚úÖ URI de redirection DOIT √™tre :</h3>
        <code style="display: block; padding: 10px; background: #fff; border: 2px solid #4285F4;">
            http://localhost:3001/api/auth/google/callback
        </code>
        <button onclick="copyCallback()" style="margin-top: 10px; background: #28a745; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 5px;">
            üìã Copier cette URI
        </button>
        
        <h3 style="margin-top: 20px;">‚úÖ Origines JavaScript DOIVENT √™tre :</h3>
        <code style="display: block; padding: 10px; background: #fff; border: 2px solid #4285F4; margin-bottom: 5px;">
            http://localhost:5173
        </code>
        <code style="display: block; padding: 10px; background: #fff; border: 2px solid #4285F4;">
            http://localhost:3001
        </code>
    </div>

    <script>
        async function testBackend() {
            const result = document.getElementById('result1');
            result.innerHTML = '<p style="color: blue;">‚è≥ Test en cours...</p>';
            
            try {
                const response = await fetch('http://localhost:3001/api/health');
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = '<p style="color: green;">‚úÖ Backend OK ! Le serveur r√©pond correctement.</p>';
                } else {
                    result.innerHTML = '<p style="color: red;">‚ùå Backend erreur : ' + response.status + '</p>';
                }
            } catch (error) {
                result.innerHTML = '<p style="color: red;">‚ùå Impossible de contacter le backend.<br>V√©rifiez que le backend tourne sur le port 3001.</p>';
            }
        }

        function testGoogleRedirect() {
            const result = document.getElementById('result2');
            result.innerHTML = '<p style="color: blue;">‚è≥ Redirection vers Google dans 2 secondes...</p>';
            
            setTimeout(() => {
                window.location.href = 'http://localhost:3001/api/auth/google';
            }, 2000);
        }

        function copyCallback() {
            const text = 'http://localhost:3001/api/auth/google/callback';
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ URI copi√©e dans le presse-papier !\n\nCollez-la dans Google Console ‚Üí URI de redirection autoris√©s');
            });
        }
    </script>
</body>
</html>

