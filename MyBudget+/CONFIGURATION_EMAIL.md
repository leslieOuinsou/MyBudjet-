# üìß Configuration de l'envoi d'emails

## **üéØ Configuration pour Gmail**

### **√âtape 1 : Cr√©er un App Password Gmail**

1. **Allez sur** : https://myaccount.google.com/security
2. **Activez la validation en 2 √©tapes** (si ce n'est pas d√©j√† fait)
3. **Allez sur** : https://myaccount.google.com/apppasswords
4. **Cr√©ez un mot de passe d'application** :
   - Nom : `MyBudget+ Backend`
   - Copiez le mot de passe g√©n√©r√© (16 caract√®res)

### **√âtape 2 : Configurer les variables d'environnement**

Ajoutez ces lignes dans votre fichier `.env` du backend :

```env
# Configuration Email
EMAIL_USER=votre-email@gmail.com
EMAIL_PASS=votre-app-password-16-caracteres
```

**Exemple :**
```env
EMAIL_USER=mybudget.app@gmail.com
EMAIL_PASS=abcd efgh ijkl mnop
```

### **√âtape 3 : Red√©marrer le backend**

```bash
cd MyBudget+/backend
npm run dev
```

---

## **üîß Configuration pour d'autres services**

### **Outlook / Hotmail**

```env
EMAIL_USER=votre-email@outlook.com
EMAIL_PASS=votre-mot-de-passe
```

Modifiez dans `emailService.js` :
```javascript
service: 'outlook'
```

### **Yahoo Mail**

```env
EMAIL_USER=votre-email@yahoo.com
EMAIL_PASS=votre-app-password
```

Modifiez dans `emailService.js` :
```javascript
service: 'yahoo'
```

### **Service SMTP personnalis√©**

```env
EMAIL_HOST=smtp.exemple.com
EMAIL_PORT=587
EMAIL_SECURE=false
EMAIL_USER=votre-email@exemple.com
EMAIL_PASS=votre-mot-de-passe
```

Modifiez dans `emailService.js` :
```javascript
return nodemailer.createTransporter({
  host: process.env.EMAIL_HOST,
  port: process.env.EMAIL_PORT,
  secure: process.env.EMAIL_SECURE === 'true',
  auth: {
    user: process.env.EMAIL_USER,
    pass: process.env.EMAIL_PASS,
  },
});
```

---

## **üß™ Test de la configuration**

### **1. Tester l'envoi d'email**

Cr√©ez un script de test `backend/test-email.js` :

```javascript
import { sendPasswordResetEmail } from './src/utils/emailService.js';
import dotenv from 'dotenv';

dotenv.config();

async function testEmail() {
  console.log('üìß Test envoi email...');
  
  const result = await sendPasswordResetEmail(
    'votre-email-test@gmail.com',
    'test-token-123456'
  );
  
  if (result.success) {
    console.log('‚úÖ Email envoy√© avec succ√®s !');
  } else {
    console.error('‚ùå √âchec envoi email:', result.error);
  }
}

testEmail();
```

Ex√©cutez :
```bash
node backend/test-email.js
```

### **2. Tester via l'application**

1. Allez sur `/forgot-password`
2. Entrez votre email
3. V√©rifiez votre bo√Æte de r√©ception (et spams)

---

## **‚ö†Ô∏è Probl√®mes courants**

### **Erreur : "Invalid login"**

- ‚úÖ V√©rifiez que vous utilisez un **App Password** (pas votre mot de passe Gmail)
- ‚úÖ V√©rifiez que la **validation en 2 √©tapes** est activ√©e
- ‚úÖ V√©rifiez qu'il n'y a pas d'espaces dans le mot de passe dans `.env`

### **Erreur : "Missing credentials"**

- ‚úÖ V√©rifiez que `EMAIL_USER` et `EMAIL_PASS` sont dans le fichier `.env`
- ‚úÖ Red√©marrez le backend apr√®s modification du `.env`

### **Email non re√ßu**

- ‚úÖ V√©rifiez le dossier **spam**
- ‚úÖ V√©rifiez la console backend pour voir si l'email a √©t√© envoy√©
- ‚úÖ Attendez quelques minutes (d√©lai de livraison)

### **Erreur : "Connection timeout"**

- ‚úÖ V√©rifiez votre connexion internet
- ‚úÖ V√©rifiez que le port 587 n'est pas bloqu√© par votre pare-feu
- ‚úÖ Essayez avec le port 465 (secure: true)

---

## **üöÄ En production (Vercel)**

### **Configuration Vercel**

1. Allez dans votre projet Vercel
2. **Settings** ‚Üí **Environment Variables**
3. Ajoutez :
   - `EMAIL_USER` : votre-email@gmail.com
   - `EMAIL_PASS` : votre-app-password
4. **Red√©ployez** votre application

---

## **üìù Mode d√©veloppement sans email**

**Par d√©faut, sans configuration email :**
- ‚úÖ Le token est affich√© dans la console du backend
- ‚úÖ Le lien de r√©initialisation est logg√©
- ‚úÖ Vous pouvez copier-coller le lien directement

C'est **parfait pour le d√©veloppement** ! üéâ

---

## **‚ú® Emails envoy√©s**

1. **Email de r√©initialisation** (`forgotPassword`)
   - Lien de r√©initialisation valide 1h
   - Design moderne avec bouton CTA
   - Instructions claires

2. **Email de confirmation** (apr√®s r√©initialisation)
   - Confirmation du changement
   - Alerte s√©curit√© si ce n'est pas l'utilisateur

---

## **üìß Personnalisation**

Pour personnaliser les emails, modifiez :
- `backend/src/utils/emailService.js`
- Templates HTML dans les fonctions `sendPasswordResetEmail` et `sendPasswordChangedEmail`

---

**Besoin d'aide ?** Contactez le support ! üòä
